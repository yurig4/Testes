<script>
document.getElementById('aulasPraticasForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);
  const dados = {};
  formData.forEach((value, key) => {
    if (dados[key]) {
      if (Array.isArray(dados[key])) {
        dados[key].push(value);
      } else {
        dados[key] = [dados[key], value];
      }
    } else {
      dados[key] = value;
    }
  });

  // ValidaÃ§Ã£o extra (laboratÃ³rio)
  const laboratorios = Array.from(document.querySelectorAll('input[name="laboratorio"]:checked')).map(el => el.value);
  if (laboratorios.length === 0) {
    alert('Por favor, selecione pelo menos um laboratÃ³rio.');
    return;
  }
  dados.laboratorio = laboratorios;

  // ValidaÃ§Ã£o 48h
  const hoje = new Date();
  const dataSelecionada = new Date(dados.data);
  const minimo = new Date();
  minimo.setDate(hoje.getDate() + 2);
  if (dataSelecionada < minimo) {
    alert('O prazo mÃ­nimo para agendamento Ã© de 48 horas.');
    return;
  }

  const btn = form.querySelector('button[type="submit"]');
  btn.disabled = true;
  btn.innerText = 'Enviando...';

  fetch('https://script.google.com/macros/s/AKfycbzmnwPGsNti7vdouZlY_bPK0dKbFGvD-zXt9ZRtXbL7nNEMbr8iNzbKFriMqh6SQcHZ/exec', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(dados)
  })
  .then(() => {
    document.querySelector('.form-container').innerHTML = `
      <h2>âœ… Agendamento realizado com sucesso!</h2>
      <p>VocÃª receberÃ¡ um e-mail de confirmaÃ§Ã£o em breve.</p>
      <button onclick="abrirUpload()">ðŸ“Ž Enviar Roteiro</button>
      <button onclick="window.location.reload()">âž• Novo Agendamento</button>
    `;
  })
  .catch(err => {
    console.error('Erro:', err);
    alert('Erro ao enviar formulÃ¡rio. Tente novamente.');
    btn.disabled = false;
    btn.innerText = 'Enviar Registro';
  });
});

function abrirUpload() {
  window.open('https://script.google.com/macros/s/SEU_DEPLOY_ID/exec?view=upload', 'uploadJanela', 'width=500,height=400');
}
</script>
